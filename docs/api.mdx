---
sidebar_position: 2
title: API
---

# General API (v0.0)

Base address: `https://parktrack-api.nawinds.dev/api/v0`

## 1. Cameras

### 1.1 GET `/cameras`
### 1.2 POST `/cameras/new`

Request data:

<table>
    <tbody>
    <tr>
        <td>title</td>
        <td>string</td>
        <td>Описание камеры (по какому адресу она находится и куда смотрит)</td>
    </tr>
    </tbody>
</table>

Response data:

<table>
    <tbody>
    <tr>
        <td>camera_id</td>
        <td>integer</td>
        <td>Числовой идентификатор созданной камеры</td>
    </tr>
    </tbody>
</table>

Ошибки:

В разработке.

Пример запроса:

```json
{
  "title": "Кронверкский просп., парковка напротив ИТМО"
}
```

Response:

```json
{
  "camera_id": 1
}
```

### 1.3 GET `/cameras/<camera_id>`
### 1.4 PUT `/cameras/<camera_id>`

## 2. Parking Zones

### 2.1 GET `/zones`
### 2.2 POST `/zones/new`

Request data:

<table>
    <tbody>
    <tr>
        <td>camera_id</td>
        <td>integer</td>
        <td>Числовой идентификатор уже существующей камеры, к которой относится новая парковочная зона</td>
    </tr>
    <tr>
        <td>zone_type</td>
        <td>string</td>
        <td>Тип парковки. `parallel` - параллельная парковка вдоль дороги, на карте будет рисоваться прямой линией, начальная и конечная точка которой берутся как середины отрезков, соединяющих соответственно оба коротких края парковочной зоны.
        `standard` - любая другая парковка, на карте отображается прямоугольником</td>
    </tr>
    <tr>
        <td>capacity</td>
        <td>integer</td>
        <td>Максимальная вместимость парковки, число мест</td>
    </tr>
    <tr>
        <td>pay</td>
        <td>integer</td>
        <td>Стоимость парковки в зоне в час, в рублях. 0 для бесплатных парковок</td>
    </tr>
    <tr>
        <td>points</td>
        <td>list</td>
        <td>Список опорных точек парковочной зоны. Содержит 2 точки для параллельных парковок и 4 для остальных</td>
    </tr>
    </tbody>
</table>

Для каждой парковочной зоны на этапе разметки определяются 4 опорные точки, задающие границы этой зоны. Для них задаются координаты широты и долготы на карте (лучше, если можно будет прямо отметить на карте все 4 опорные точки в интерфейсе, а не вводить вручную),
а также координаты на изображении с соответствующей камеры X и Y (отмечаются прямо на изображении курсором).
Структура опорной точки из списка `points`:

<table>
    <tbody>
    <tr>
        <td>latitude</td>
        <td>float</td>
        <td>Координата широты опорной точки</td>
    </tr>
    <tr>
        <td>longitude</td>
        <td>float</td>
        <td>Координата долготы опорной точки</td>
    </tr>
    <tr>
        <td>x</td>
        <td>float</td>
        <td>Координата x опорной точки на изображении с камеры</td>
    </tr>
    <tr>
        <td>y</td>
        <td>float</td>
        <td>Координата x опорной точки на изображении с камеры</td>
    </tr>
    </tbody>
</table>

<details>
<summary>Структура points[]</summary>

- **latitude** (`float`) — …
- **longitude** (`float`) — …
- **x** (`float`) — …
- **y** (`float`) — …
</details>

Response data:

<table>
    <tbody>
    <tr>
        <td>zone_id</td>
        <td>integer</td>
        <td>Числовой идентификатор созданной парковочной зоны</td>
    </tr>
    </tbody>
</table>

Ошибки:

В разработке.

404 status code = камеры с указанным camera_id не существует

Пример запроса:

```json
{
  "camera_id": 1,
  "zone_type": "parallel",
  "capacity": 7,
  "pay": 0,
  "points": [
    {
      "latitude": 59.955976,
      "longitude": 30.309426,
      "x": 45,
      "y": 23
    },
    {
      "latitude": 59.956008,
      "longitude": 30.309358,
      "x": 87,
      "y": 25
    },
    {
      "latitude": 59.956231,
      "longitude": 30.309979,
      "x": 79,
      "y": 149
    },
    {
      "latitude": 59.956201,
      "longitude": 30.310043,
      "x": 32,
      "y": 145
    }
  ]
}
```

Response:

```json
{
  "zone_id": 1
}
```

### 2.3 GET `/zones/<zone_id>`

Пример ответа:

```json
{
  "zone_id": 1,
  "camera_id": 1,
  "zone_type": "parallel",
  "capacity": 7,
  "occupied": 5,
  "confidence": 0.76,
  "pay": 0,
  "points": [
    {
      "latitude": 59.955976,
      "longitude": 30.309426,
      "x": 45,
      "y": 23
    },
    {
      "latitude": 59.956008,
      "longitude": 30.309358,
      "x": 87,
      "y": 25
    },
    {
      "latitude": 59.956231,
      "longitude": 30.309979,
      "x": 79,
      "y": 149
    },
    {
      "latitude": 59.956201,
      "longitude": 30.310043,
      "x": 32,
      "y": 145
    }
  ]
}
```

### 2.4 PUT `/zones/<zone_id>`

Примеры запроса:

1.
```json
{
  "occupied": 5,
  "confidence": 0.76
}
```

2.
```json
{
  "camera_id": 1,
  "zone_type": "parallel",
  "capacity": 7,
  "pay": 0,
  "points": [
    {
      "latitude": 59.955976,
      "longitude": 30.309426,
      "x": 45,
      "y": 23
    },
    {
      "latitude": 59.956008,
      "longitude": 30.309358,
      "x": 87,
      "y": 25
    },
    {
      "latitude": 59.956231,
      "longitude": 30.309979,
      "x": 79,
      "y": 149
    },
    {
      "latitude": 59.956201,
      "longitude": 30.310043,
      "x": 32,
      "y": 145
    }
  ]
}
```

## 3. Cars

### 3.1 POST `/cars`

Пример запроса:

1.
```json
{
  "camera_id": 1,
  "cars": [
    {
      "confidence": 0.89,
      "points": [
        [23, 28],
        [87, 28],
        [87, 42],
        [23, 42]
      ]
    },
    {
      "confidence": 0.91,
      "points": [
        [28, 33],
        [92, 33],
        [92, 47],
        [28, 47]
      ]
    }
  ]
}
```

### 3.2 GET `/cars`

Long polling endpoint for fetching updates

Пример ответа:

1.
```json
{
  "camera_id": 1,
  "cars": [
    {
      "confidence": 0.89,
      "points": [
        [23, 28],
        [87, 28],
        [87, 42],
        [23, 42]
      ]
    },
    {
      "confidence": 0.91,
      "points": [
        [28, 33],
        [92, 33],
        [92, 47],
        [28, 47]
      ]
    }
  ]
}
```